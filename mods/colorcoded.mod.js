(()=>{var t={71:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>a});var n=o(81),s=o.n(n),i=o(645),r=o.n(i)()(s());r.push([t.id,"#ingame_HUD_ColorSelector {\n    display: flex;\n    flex-direction: column;\n    gap: 0.3em;\n\n    position: absolute;\n    top: 50%;\n    right: 0;\n    z-index: 200;\n    transform: translate(100%, -50%);\n    transition: transform 0.3s ease-in;\n\n    background: #0006;\n    backdrop-filter: blur(calc(10px * var(--ui-scale)));\n    border-top-left-radius: calc(10px * var(--ui-scale));\n    border-bottom-left-radius: calc(10px * var(--ui-scale));\n    box-shadow: 0 0 0.8em #0004;\n\n    padding: calc(10px * var(--ui-scale));\n}\n\n#ingame_HUD_ColorSelector.visible {\n    transform: translate(0, -50%);\n}\n\n#ingame_HUD_ColorSelector canvas {\n    width: calc(32px * var(--ui-scale));\n    height: calc(32px * var(--ui-scale));\n}\n",""]);const a=r},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var o="",n=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),n&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=t(e),n&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o})).join("")},e.i=function(t,o,n,s,i){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(n)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(r[c]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);n&&r[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),o&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=o):d[2]=o),s&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=s):d[4]="".concat(s)),e.push(d))}},e}},81:t=>{"use strict";t.exports=function(t){return t[1]}},257:(t,e,o)=>{"use strict";var n={};o.r(n),o.d(n,{drawChunk:()=>k,drawWiresChunk:()=>_});var s={};o.r(s),o.d(s,{drawChunk:()=>D});var i={};o.r(i),o.d(i,{drawChunk:()=>G});const{round2Digits:r}=shapez,{enumColors:a}=shapez,c={};function l(t){if(t.color==a.white)return"grayscale(1) brightness(1.1)";const e=t.getBackgroundColorAsResource();if(!e)return"grayscale(1)";const o=function(t){const e=parseInt(t.slice(1),16),o=(e>>16)/255,n=(e>>8&255)/255,s=(255&e)/255,i=Math.max(o,n,s),r=Math.min(o,n,s);if(i==r)return null;let a=-1;const c=i-r;switch(i){case o:a=(n-s)/c+(n<s?6:0);break;case n:a=(s-o)/c+2;break;case s:a=(o-n)/c+4}return a/=6,Math.floor(360*a)}(e);return null==o?"grayscale(1)":`contrast(0.8) saturate(1.8) brightness(0.85) hue-rotate(${r(o-47)}deg)`}const{enumColors:d,enumColorToShortcode:h,enumShortcodeToColor:p}=shapez,{Component:u}=shapez,{types:f}=shapez,{AtlasSprite:m,ORIGINAL_SPRITE_SCALE:g,SpriteAtlasLink:C}=shapez;class S extends u{static getId(){return"ColorCoded"}static getSchema(){return{color:f.string}}constructor({color:t="u"}){super(),window.assert(!!p[t],"Invalid color: ",t),this.color=t}copyAdditionalStateTo(t){t.color=this.color}hasColorFilter(){return this.color!=h[d.uncolored]}getColorFilter(){return"brightness(0.8) sepia(100%) brightness(1.1) "+c[p[this.color]]}createSprite(t,e){const o=t.linksByResolution[g],{w:n,h:s}=o,i=new m(t.spriteName),r=document.createElement("canvas");r.width=n,r.height=s;const a=r.getContext("2d");a.filter=e,t.draw(a,0,0,n,s);const c=new C({w:n,h:s,atlas:r,packOffsetX:0,packOffsetY:0,packedX:0,packedY:0,packedW:n,packedH:s});for(const t of["0.25","0.5","0.75"])i.linksByResolution[t]=c;return i}getSprite(t){if(!this.hasColorFilter())return t;t.colorCoded||(t.colorCoded=[]);const e=this.getColorFilter();return t.colorCoded[e]||(t.colorCoded[e]=this.createSprite(t,e)),t.colorCoded[e]}}const{ClickDetector:y}=shapez,{makeDiv:b}=shapez,{enumColorToShortcode:v}=shapez,{BaseHUDPart:z}=shapez,{DynamicDomAttach:w}=shapez,{COLOR_ITEM_SINGLETONS:B}=shapez;class x extends z{createElements(t){this.element=b(t,"ingame_HUD_ColorSelector");for(const t of Object.values(B)){const e=document.createElement("canvas");e.width=64,e.height=64;const o=e.getContext("2d");t.drawFullSizeOnCanvas(o,64),this.element.appendChild(e),new y(e,{}).click.add(this.repaintSelection.bind(this,t))}}initialize(){this.domAttach=new w(this.root,this.element,{attachClass:"visible",timeToKeepSeconds:.3})}repaintSelection(t){const e=this.root.hud.parts.massSelector;for(const o of e.selectedUids){const e=this.root.entityMgr.findByUid(o);e.components.ColorCoded&&(e.components.ColorCoded.color=v[t.color])}}update(){const t=this.root.hud.parts.massSelector;this.domAttach.update(t.selectedUids.size>0)}}const T={dark:{yellow:"#a3a168",cyan:"#709999",purple:"#996099"},light:{yellow:"#fffebf",cyan:"#bffffb",purple:"#ffbfff"}},{globalConfig:M}=shapez;function E(t,e,o){const{StaticMapEntity:n,ColorCoded:s}=t.components,i=s.getSprite(o);n.drawSpriteOnBoundsClipped(e,i,2)}function k(t,[e,o]){const n=o.containedEntitiesByLayer.regular;for(const t of n){const o=t.components.StaticMapEntity.getSprite();if(o){if(this.drawnUids.has(t.uid))continue;this.drawnUids.add(t.uid),E(t,e,o)}}}function _(t,[e,o]){const n=new Set,s=o.wireContents;for(let t=0;t<M.mapChunkSize;++t)for(let o=0;o<M.mapChunkSize;++o){const i=s[o][t];if(i){if(n.has(i.uid))continue;n.add(i.uid);const t=i.components.StaticMapEntity.getSprite();t&&E(i,e,t)}}}const{globalConfig:O}=shapez,{BELT_ANIM_COUNT:L}=shapez;function U(t){return Math.floor(t.time.realtimeNow()*function(t){return Math.min(t.hubGoals.getBeltBaseSpeed(),10)}(t)*L*126/42*O.itemSpacingOnBelts)}const{BELT_ANIM_COUNT:I}=shapez;function A(t,e,o){let n=null;const s=this.root.app.mousePosition;if(s&&"regular"===this.root.currentLayer){const{x:t,y:e}=this.root.camera.screenToWorld(s).toTileSpace(),o=this.root.map.getLayerContentXY(t,e,"regular");o&&o.components.Belt&&(n=o.components.Belt.assignedPath)}for(const s of e){if(!s.components.Belt)continue;const e=s.components.Belt.direction;let i=this.beltAnimations[e][0];s.components.Belt.assignedPath===n&&(i=this.beltAnimations[e][o%I]),s.components.StaticMapEntity.drawSpriteOnBoundsClipped(t,s.components.ColorCoded.getSprite(i),0)}}function D(t,[e,o]){const n=U(this.root),s=o.containedEntitiesByLayer.regular;if(this.root.app.settings.getAllSettings().simplifiedBelts)A.call(this,e,s,n);else for(const t of s){if(!t.components.Belt)continue;const o=t.components.Belt.direction,s=this.beltAnimations[o][n%I];t.components.StaticMapEntity.drawSpriteOnBoundsClipped(e,t.components.ColorCoded.getSprite(s),0)}}const{globalConfig:R}=shapez,{Rectangle:N}=shapez,{FULL_CLIP_RECT:P}=shapez,{enumDirectionToAngle:H}=shapez,{enumClippedBeltUnderlayType:j}=shapez,F={[j.none]:null,[j.full]:P,[j.topOnly]:new N(0,0,1,.5),[j.bottomOnly]:new N(0,.5,1,.5)};function W(t,e,o){const n=t.components.StaticMapEntity,s=t.components.BeltUnderlays.underlays;for(const i of s){const{pos:s,direction:r}=i,a=n.localTileToWorld(s),c=a.x*R.tileSize,l=a.y*R.tileSize;if(!o.tileSpaceRectangle.containsPoint(a.x,a.y))continue;if(!e.visibleRect.containsRect4Params(c,l,R.tileSize,R.tileSize))continue;const d=n.localDirectionToWorld(r),h=H[d],p=this.computeBeltUnderlayType(t,i),u=F[p];if(!u)continue;const f=c+R.halfTileSize,m=l+R.halfTileSize,g=Math.radians(h),C=U(this.root);e.context.translate(f,m),e.context.rotate(g);const S=this.underlayBeltSprites[C%this.underlayBeltSprites.length];t.components.ColorCoded.getSprite(S).drawCachedWithClipRect(e,-R.halfTileSize,-R.halfTileSize,R.tileSize,R.tileSize,u),e.context.rotate(-g),e.context.translate(-f,-m)}}function G(t,[e,o]){const n=o.containedEntitiesByLayer.regular;for(const t of n)t.components.BeltUnderlays&&W.call(this,t,e,o)}var Y=o(546),$=o.n(Y);const X=JSON.parse('{"entry":"./index.js","name":"ColorCoded","description":"Allows you to enhance design of your factories by color coding.","version":"0.2.1b","id":"dengr1065:colorcoded","minimumGameVersion":">=1.5.0","settings":{"firstLaunch":true}}'),V="https://github.com/dengr1065/shapez.io-mods/issues".replace(/.+/,'<a href="$&">$&</a>'),q=["This mod might conflict with other installed mods","because it replaces core parts of the game with","own implementations. Some features might not work,","and the game may crash. ColorCoded attempts to","support buildings and colors from other mods, but","they must be registered in correct loading stages.","","The mod also has own HUD parts, so HUD from other","mods might get obstructed. If that's the case,","please let me know!","","Using ColorCoded on savegames created without it","is dangerous and can cause unexpected behavior.","Savegames created with this mod might also not","load without it. To avoid possible savegame","corruptions, make frequent backups.","",...X.version.endsWith("b")?["You're on a beta version of ColorCoded, expect some bugs."]:[],"Report issues to "+V,"Visit the mod loader Discord server for support."].join("<br>"),{Mod:J}=shapez,{StaticMapEntitySystem:K}=shapez,{BeltSystem:Q}=shapez,{BeltUnderlaysSystem:Z}=shapez,{COLOR_ITEM_SINGLETONS:tt}=shapez,{gMetaBuildingRegistry:et}=shapez,{THEMES:ot}=shapez,{MainMenuState:nt}=shapez,st=[{cls:K,patches:n},{cls:Q,patches:s},{cls:Z,patches:i}];var it,rt;it=class extends J{init(){this.modInterface.registerComponent(S),this.component=S;for(const{cls:t,patches:e}of st)for(const o in e)this.modInterface.replaceMethod(t,o,e[o]);this.signals.appBooted.add(this.setMissingColors,this),this.signals.appBooted.add(this.setColorFilters,this),this.signals.appBooted.add(this.patchEntityComponents,this),this.signals.stateEntered.add(this.firstLaunch,this),this.signals.gameInitialized.add(this.registerHud,this),this.modInterface.registerCss($())}setColorFilters(){for(const t of Object.values(tt))c[t.color]=l(t)}patchEntityComponents(){for(const t of et.entries)this.modInterface.runAfterMethod(t.constructor,"setupEntityComponents",(function(t){t.addComponent(new S({}))}))}setMissingColors(){for(const t in T){const e=ot[t].map.resources;for(const o in T[t])e[o]||(e[o]=T[t][o])}}firstLaunch(t){if(t instanceof nt){if(!this.settings.firstLaunch)return;this.dialogs.showWarning("ColorCoded",q,["ok:good:timeout"]).ok.add((()=>{this.settings.firstLaunch=!1,this.saveSettings()}))}}registerHud(t){const e=new x(t);t.hud.parts.colorSelector=e,this.signals.hudElementInitialized.dispatch(e),e.createElements(document.body),e.initialize(),this.signals.hudElementFinalized.dispatch(e)}},(rt=X).author="Даниїл Григор'єв <dengr1065@gmail.com>",delete rt.entry,window.$shapez_registerMod(it,rt)},546:(t,e,o)=>{var n=o(71);n&&n.__esModule&&(n=n.default),t.exports="string"==typeof n?n:n.toString()}},e={};function o(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={id:n,exports:{}};return t[n](i,i.exports,o),i.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o(257)})();
